tosca_definitions_version: tosca_simple_yaml_1_0

description: Setup CORD-related services -- vOLT, vCPE, vBNG.

imports:
   - custom_types/xos.yaml

topology_template:
  node_templates:
    management:
      type: tosca.nodes.network.Network
      properties:
          ip_version: 4
          cidr: 172.27.0.0/24
      requirements:
          - network_template:
              node: management_template
              relationship: tosca.relationships.UsesNetworkTemplate
          - owner:
              node: mysite_management
              relationship: tosca.relationships.MemberOfSlice

    mysite:
      type: tosca.nodes.Site

    mysite_management:
      description: This slice exists solely to own the management network
      type: tosca.nodes.Slice
      properties:
          network: noauto
      requirements:
          - site:
              node: mysite
              relationship: tosca.relationships.MemberOfSite

    service_ONOS_VTN:
      type: tosca.nodes.ONOSService
      requirements:
      properties:
          kind: onos
          view_url: /admin/onos/onosservice/$id$/
          no_container: true
          rest_hostname: onos-cord

    VTN_ONOS_app:
      type: tosca.nodes.ONOSVTNApp
      requirements:
          - onos_tenant:
              node: service_ONOS_VTN
              relationship: tosca.relationships.TenantOfService
      properties:
          dependencies: org.onosproject.drivers, org.onosproject.drivers.ovsdb, org.onosproject.lldpprovider, org.onosproject.openflow-base, org.onosproject.ovsdb-base, org.onosproject.dhcp, org.onosproject.openstackswitching, org.onosproject.cordvtn
          rest_onos/v1/network/configuration/: { get_artifact: [ SELF, vtn_network_cfg_json, LOCAL_FILE ] }
      artifacts:
          vtn_network_cfg_json: /root/setup/vtn-network-cfg.json
