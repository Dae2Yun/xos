<a href="/admin/core/instance/add/?_to_field=id&slice=1" class="add-another" id="add_instance_advanced"
onclick="return showAddInstancePopup(this);">
Add Instance using expert settings window
</a>
<!-- div id="instance_advanced" style="display: node;" onchange="console.log('changed');" -->
<input type="hidden" id="instance_advanced" name="instance_advanced" onchange="console.log('changed');" value="initial">

<script>

// ugly - poll for djange to change "instance_advanced", and it it does, then refresh the
// page so the instance list gets updated.
var last_instance_advanced = $("#instance_advanced").val();
checkInstanceAdvanced = function() {
    cur = $("#instance_advanced").val();
    if (cur != last_instance_advanced) {
        last_instance_advanced = cur;
        location.reload();
   }
};

setInterval(function() { checkInstanceAdvanced(); }, 1000); 

function showAddInstancePopup(triggeringLink) {
    var name = triggeringLink.id.replace(/^add_/, '');
    name = id_to_windowname(name);
    var href = triggeringLink.href;
    if (href.indexOf('?') == -1) {
        href += '?_popup=1';
    } else {
        href  += '&_popup=1';
    }
    var win = window.open(href, name, 'height=500,width=1080,resizable=yes,scrollbars=yes');
    win.focus();
    return false;
}

</script>
