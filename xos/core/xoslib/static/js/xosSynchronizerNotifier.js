"use strict";angular.module("xos.synchronizerNotifier",["ngResource","ngCookies","ui.router","xos.helpers"]).config(["$provide",function(n){n.decorator("$rootScope",["$delegate",function(n){var t=n.constructor,s=t.prototype.$on;return t.prototype.$on=function(){return s.apply(this,arguments)},n}])}]).service("Diag",["$rootScope","$http","$q","$interval",function(n,t,s,e){var o=this,i=!1;this.getDiags=function(){var n=s.defer();return t.get("/api/core/diags").then(function(t){n.resolve(t.data)})["catch"](function(t){n.reject(t)}),n.promise},this.sendEvents=function(t){t.forEach(function(t){var s=JSON.parse(t.backend_register);s.last_run=new Date(1e3*s.last_run),n.$broadcast("diag",{name:t.name,updated:t.updated,info:s,status:o.getSyncStatus(s)})})},this.start=function(){return i=!0,o.getDiags().then(function(n){o.sendEvents(n)}),i},this.stop=function(){return i=!1},this.getSyncStatus=function(n){var t=3e5;return!(new Date-n.last_run>t)},e(function(){i&&o.getDiags().then(function(n){o.sendEvents(n)})},25e3)}]).run(["$log",function(n){n.info("Listening for Syncronizers Events!")}]).directive("syncStatus",function(){return{restrict:"E",scope:{},bindToController:!0,controllerAs:"vm",templateUrl:"templates/sync-status.tpl.html",controller:["$log","$rootScope","Diag",function(n,t,s){var e=this;s.start(),this.synchronizers={},this.showNoSync=!0,t.$on("diag",function(n,t){e.synchronizers[t.name]=t,e.showNoSync=!1,0===Object.keys(e.synchronizers).length&&(e.showNoSync=!0)})}]}}),angular.element(document).ready(function(){angular.bootstrap("#xosSynchronizerNotifier",["xos.synchronizerNotifier"])}),angular.module("xos.synchronizerNotifier").run(["$templateCache",function(n){n.put("templates/sync-status.tpl.html",'<div class="sync-status-container">\n  <div class="btn btn-default" ng-click="vm.showNotificationPanel = !vm.showNotificationPanel">\n    <i class="glyphicon glyphicon-inbox"></i>\n  </div>\n  <div class="notification-panel panel panel-default" ng-show="vm.showNotificationPanel">\n    <ul class="list-group" ng-show="vm.showNoSync">\n      <li class="list-group-item" ng-repeat="(syncName, syncStatus) in vm.synchronizers">\n        <span class="badge" ng-class="{success: syncStatus.status, danger: !syncStatus.status}">\n          <span ng-show="syncStatus.status"><i class="glyphicon glyphicon-ok"></i></span>\n          <span ng-hide="syncStatus.status"><i class="glyphicon glyphicon-remove"></i></span>\n        </span>\n        <b>{{syncName}}</b>\n        <br/>\n        <small><i>{{syncStatus.info.last_run | date:\'mediumTime\'}}</i></small>\n      </li>\n    </ul>\n    <div class="alert alert-info" ng-show="vm.showNoSync">\n      No syncronizers are running.\n    </div>\n  </div>\n</div>\n')}]),angular.module("xos.synchronizerNotifier").run(["$location",function(n){n.path("/")}]);